<script>
    map.on('style.load', function () {
        let fHover;

        map.on('mousemove', function (e) {
            var features = map.queryRenderedFeatures(e.point, {
                layers: ['building-3d']
            });
            if (features[0]) {
                mouseout();
                mouseover(features[0]);
            } else {
                mouseout();
            }

        });

        map.on('mouseout', function (e) {
            mouseout();
        });

        function mouseout() {
            if (!fHover) return;
            map.getCanvasContainer().style.cursor = 'default';
            map.setFeatureState({
                source: fHover.source,
                sourceLayer: fHover.sourceLayer,
                id: fHover.id
            }, {
                hover: false
            });

        }

        function mouseover(feature) {
            fHover = feature;
            map.getCanvasContainer().style.cursor = 'pointer';

            map.setFeatureState({
                source: fHover.source,
                sourceLayer: fHover.sourceLayer,
                id: fHover.id
            }, {
                hover: true
            });
        }

        map.on('click', 'states-layer', function (e) {
            new maplibregl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(e.features[0].properties.name)
                .addTo(map);
        });

        // Change the cursor to a pointer when the mouse is over the states layer.
        map.on('mouseenter', 'states-layer', function () {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change it back to a pointer when it leaves.
        map.on('mouseleave', 'states-layer', function () {
            map.getCanvas().style.cursor = '';
        });
    });
</script>